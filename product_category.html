<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>HAKTAN - Ürünler</title>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <style>
        body {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
</head>

<body class="bg-gray-50 text-text-main font-display min-h-screen flex flex-col">
    <!-- Header injected by main.js -->

    <main class="flex-1 container mx-auto px-4 md:px-12 lg:px-20 py-4 lg:py-8 max-w-7xl">
        <nav class="text-xs text-text-muted mb-4 flex items-center gap-1.5">
            <a href="index.html" class="hover:text-primary">Ana Sayfa</a>
            <span class="material-symbols-outlined text-[14px]">chevron_right</span>
            <span id="breadcrumbCat" class="text-text-main font-semibold">Ürünler</span>
        </nav>

        <!-- ===== Category Hero - Static Image ===== -->
        <section id="categoryHero" class="relative w-full rounded-2xl overflow-hidden mb-8 shadow-xl"
            style="min-height: 340px;">
            <!-- Hero content injected via JS based on category -->
            <style>
                .cat-slide {
                    position: absolute;
                    inset: 0;
                    opacity: 0;
                    transition: opacity 1s ease-in-out;
                    z-index: 0;
                }

                .cat-slide.active {
                    opacity: 1;
                    z-index: 1;
                }

                .cat-dot {
                    width: 10px;
                    height: 10px;
                    border-radius: 9999px;
                    background: rgba(255, 255, 255, 0.45);
                    border: 2px solid rgba(255, 255, 255, 0.6);
                    cursor: pointer;
                    transition: all 0.3s ease;
                }

                .cat-dot.active {
                    background: #ec9213;
                    border-color: #ec9213;
                    width: 28px;
                }

                .cat-progress {
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    height: 3px;
                    background: linear-gradient(90deg, #ec9213, #f5a623);
                    z-index: 10;
                    transition: width 0.1s linear;
                }

                .cat-slide .slide-content {
                    transform: translateY(30px);
                    opacity: 0;
                    transition: all 0.8s ease 0.3s;
                }

                .cat-slide.active .slide-content {
                    transform: translateY(0);
                    opacity: 1;
                }

                .cat-arrow {
                    position: absolute;
                    top: 50%;
                    transform: translateY(-50%);
                    z-index: 5;
                    width: 44px;
                    height: 44px;
                    border-radius: 50%;
                    background: rgba(255, 255, 255, 0.15);
                    backdrop-filter: blur(8px);
                    border: 1px solid rgba(255, 255, 255, 0.25);
                    color: white;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    opacity: 0;
                }

                #categoryHero:hover .cat-arrow {
                    opacity: 1;
                }

                .cat-arrow:hover {
                    background: rgba(236, 146, 19, 0.85);
                    border-color: rgba(236, 146, 19, 0.9);
                    transform: translateY(-50%) scale(1.1);
                }

                .cat-arrow.left {
                    left: 16px;
                }

                .cat-arrow.right {
                    right: 16px;
                }

                @media (max-width: 768px) {
                    #categoryHero {
                        min-height: 280px;
                    }

                    .cat-arrow {
                        opacity: 1;
                        width: 36px;
                        height: 36px;
                    }
                }
            </style>

            <!-- Slide 1: Kuruyemiş -->
            <div class="cat-slide active" data-cat="kuruyemis">
                <div
                    style="position:absolute;inset:0;background:url('src/images/kuruyemis.png') center/cover no-repeat;">
                </div>
                <div
                    style="position:absolute;inset:0;background:linear-gradient(135deg, rgba(30,20,10,0.85) 0%, rgba(30,20,10,0.5) 50%, rgba(30,20,10,0.2) 100%);">
                </div>
                <div class="slide-content"
                    style="position:absolute;inset:0;display:flex;align-items:center;padding:2rem 2.5rem;">
                    <div style="max-width:480px;">
                        <span
                            style="display:inline-flex;align-items:center;gap:4px;background:rgba(236,146,19,0.2);border:1px solid rgba(236,146,19,0.4);color:#f5a623;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;padding:4px 12px;border-radius:20px;margin-bottom:12px;backdrop-filter:blur(4px);">
                            <span class="material-symbols-outlined" style="font-size:12px;">local_fire_department</span>
                            En Çok Tercih Edilen
                        </span>
                        <h2
                            style="font-size:clamp(1.5rem,3.5vw,2.4rem);font-weight:900;color:white;line-height:1.1;margin-bottom:10px;letter-spacing:-0.4px;">
                            Taze Kavrulmuş<br>Kuruyemiş</h2>
                        <p
                            style="color:rgba(255,255,255,0.8);font-size:clamp(0.8rem,1.2vw,0.9rem);line-height:1.5;margin-bottom:20px;max-width:380px;">
                            Antep fıstığından kaju cevizine, bademden fındığa… Taze kavrulmuş, birinci sınıf
                            kuruyemişlerin en seçkinleri.</p>
                        <a href="product_category.html?cat=kuruyemis"
                            style="display:inline-flex;align-items:center;gap:6px;background:#ec9213;color:white;padding:10px 24px;border-radius:8px;font-weight:700;font-size:0.9rem;text-decoration:none;transition:all 0.3s;box-shadow:0 4px 15px rgba(236,146,19,0.3);">
                            Keşfet <span class="material-symbols-outlined" style="font-size:16px;">arrow_forward</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Slide 2: Şarküteri -->
            <div class="cat-slide" data-cat="sarkuteri">
                <div
                    style="position:absolute;inset:0;background:url('src/images/sarkuteri.jpg') center/cover no-repeat;">
                </div>
                <div
                    style="position:absolute;inset:0;background:linear-gradient(135deg, rgba(50,15,15,0.85) 0%, rgba(40,15,15,0.5) 50%, rgba(40,15,15,0.2) 100%);">
                </div>
                <div class="slide-content"
                    style="position:absolute;inset:0;display:flex;align-items:center;padding:2rem 2.5rem;">
                    <div style="max-width:520px;">
                        <span
                            style="display:inline-flex;align-items:center;gap:6px;background:rgba(220,60,60,0.2);border:1px solid rgba(220,60,60,0.4);color:#f87171;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;padding:5px 14px;border-radius:20px;margin-bottom:16px;backdrop-filter:blur(4px);">
                            <span class="material-symbols-outlined" style="font-size:14px;">restaurant</span>
                            Gurme Seçim
                        </span>
                        <h2
                            style="font-size:clamp(1.8rem,4vw,2.8rem);font-weight:900;color:white;line-height:1.15;margin-bottom:12px;letter-spacing:-0.5px;">
                            Premium<br>Şarküteri</h2>
                        <p
                            style="color:rgba(255,255,255,0.8);font-size:clamp(0.85rem,1.5vw,1.05rem);line-height:1.6;margin-bottom:24px;max-width:400px;">
                            Sucuk, pastırma, kaşar peyniri ve daha fazlası… Geleneksel tariflerle hazırlanan şarküteri
                            lezzetleri sofranızda.</p>
                        <a href="product_category.html?cat=sarkuteri"
                            style="display:inline-flex;align-items:center;gap:8px;background:#ec9213;color:white;padding:12px 28px;border-radius:10px;font-weight:700;font-size:0.95rem;text-decoration:none;transition:all 0.3s;box-shadow:0 4px 20px rgba(236,146,19,0.35);">
                            Keşfet <span class="material-symbols-outlined" style="font-size:18px;">arrow_forward</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Slide 3: Aktar -->
            <div class="cat-slide" data-cat="aktar">
                <div style="position:absolute;inset:0;background:url('src/images/aktar.png') center/cover no-repeat;">
                </div>
                <div
                    style="position:absolute;inset:0;background:linear-gradient(135deg, rgba(20,40,20,0.85) 0%, rgba(20,40,20,0.5) 50%, rgba(20,40,20,0.15) 100%);">
                </div>
                <div class="slide-content"
                    style="position:absolute;inset:0;display:flex;align-items:center;padding:2rem 2.5rem;">
                    <div style="max-width:520px;">
                        <span
                            style="display:inline-flex;align-items:center;gap:6px;background:rgba(34,197,94,0.2);border:1px solid rgba(34,197,94,0.4);color:#4ade80;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;padding:5px 14px;border-radius:20px;margin-bottom:16px;backdrop-filter:blur(4px);">
                            <span class="material-symbols-outlined" style="font-size:14px;">spa</span>
                            Doğal & Şifalı
                        </span>
                        <h2
                            style="font-size:clamp(1.8rem,4vw,2.8rem);font-weight:900;color:white;line-height:1.15;margin-bottom:12px;letter-spacing:-0.5px;">
                            Şifalı Bitkiler<br>& Baharatlar</h2>
                        <p
                            style="color:rgba(255,255,255,0.8);font-size:clamp(0.85rem,1.5vw,1.05rem);line-height:1.6;margin-bottom:24px;max-width:400px;">
                            Doğanın şifa deposu… Bitkisel çaylar, baharatlar ve aromatik bitkiler ile sağlıklı yaşamın
                            kapısını aralayın.</p>
                        <a href="product_category.html?cat=aktar"
                            style="display:inline-flex;align-items:center;gap:8px;background:#ec9213;color:white;padding:12px 28px;border-radius:10px;font-weight:700;font-size:0.95rem;text-decoration:none;transition:all 0.3s;box-shadow:0 4px 20px rgba(236,146,19,0.35);">
                            Keşfet <span class="material-symbols-outlined" style="font-size:18px;">arrow_forward</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Slide 4: Bakliyat -->
            <div class="cat-slide" data-cat="bakliyat">
                <div
                    style="position:absolute;inset:0;background:url('src/images/bakliyat.jpg') center/cover no-repeat;">
                </div>
                <div
                    style="position:absolute;inset:0;background:linear-gradient(135deg, rgba(60,40,10,0.85) 0%, rgba(50,35,10,0.5) 50%, rgba(40,30,10,0.15) 100%);">
                </div>
                <div class="slide-content"
                    style="position:absolute;inset:0;display:flex;align-items:center;padding:2rem 2.5rem;">
                    <div style="max-width:520px;">
                        <span
                            style="display:inline-flex;align-items:center;gap:6px;background:rgba(234,179,8,0.2);border:1px solid rgba(234,179,8,0.4);color:#facc15;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;padding:5px 14px;border-radius:20px;margin-bottom:16px;backdrop-filter:blur(4px);">
                            <span class="material-symbols-outlined" style="font-size:14px;">grain</span>
                            Doğal & Yerli
                        </span>
                        <h2
                            style="font-size:clamp(1.8rem,4vw,2.8rem);font-weight:900;color:white;line-height:1.15;margin-bottom:12px;letter-spacing:-0.5px;">
                            Doğal<br>Bakliyat</h2>
                        <p
                            style="color:rgba(255,255,255,0.8);font-size:clamp(0.85rem,1.5vw,1.05rem);line-height:1.6;margin-bottom:24px;max-width:400px;">
                            Kırmızı mercimek, nohut, fasulye, bulgur… Anadolu'nun bereketli topraklarından sofralarınıza
                            en taze bakliyatlar.</p>
                        <a href="product_category.html?cat=bakliyat"
                            style="display:inline-flex;align-items:center;gap:8px;background:#ec9213;color:white;padding:12px 28px;border-radius:10px;font-weight:700;font-size:0.95rem;text-decoration:none;transition:all 0.3s;box-shadow:0 4px 20px rgba(236,146,19,0.35);">
                            Keşfet <span class="material-symbols-outlined" style="font-size:18px;">arrow_forward</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Slide 5: Pestil & Köme -->
            <div class="cat-slide" data-cat="pestil-kome">
                <div
                    style="position:absolute;inset:0;background:url('src/images/pestilkome.jpg') center/cover no-repeat;">
                </div>
                <div
                    style="position:absolute;inset:0;background:linear-gradient(135deg, rgba(80,20,50,0.85) 0%, rgba(60,15,40,0.5) 50%, rgba(50,10,30,0.15) 100%);">
                </div>
                <div class="slide-content"
                    style="position:absolute;inset:0;display:flex;align-items:center;padding:2rem 2.5rem;">
                    <div style="max-width:520px;">
                        <span
                            style="display:inline-flex;align-items:center;gap:6px;background:rgba(192,38,211,0.2);border:1px solid rgba(192,38,211,0.4);color:#e879f9;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;padding:5px 14px;border-radius:20px;margin-bottom:16px;backdrop-filter:blur(4px);">
                            <span class="material-symbols-outlined" style="font-size:14px;">star</span>
                            Geleneksel Tatlar
                        </span>
                        <h2
                            style="font-size:clamp(1.8rem,4vw,2.8rem);font-weight:900;color:white;line-height:1.15;margin-bottom:12px;letter-spacing:-0.5px;">
                            Pestil &<br>Köme</h2>
                        <p
                            style="color:rgba(255,255,255,0.8);font-size:clamp(0.85rem,1.5vw,1.05rem);line-height:1.6;margin-bottom:24px;max-width:400px;">
                            Gümüşhane'nin meşhur pestili, Kayseri'nin köme ve sucuğu… Nesilden nesile aktarılan
                            geleneksel lezzetler.</p>
                        <a href="product_category.html?cat=pestil-kome"
                            style="display:inline-flex;align-items:center;gap:8px;background:#ec9213;color:white;padding:12px 28px;border-radius:10px;font-weight:700;font-size:0.95rem;text-decoration:none;transition:all 0.3s;box-shadow:0 4px 20px rgba(236,146,19,0.35);">
                            Keşfet <span class="material-symbols-outlined" style="font-size:18px;">arrow_forward</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Slide 6: Yöresel Ürünler -->
            <div class="cat-slide" data-cat="yoresel">
                <div style="position:absolute;inset:0;background:url('src/images/yoresel.png') center/cover no-repeat;">
                </div>
                <div
                    style="position:absolute;inset:0;background:linear-gradient(135deg, rgba(60,30,10,0.85) 0%, rgba(50,25,8,0.5) 50%, rgba(40,20,5,0.15) 100%);">
                </div>
                <div class="slide-content"
                    style="position:absolute;inset:0;display:flex;align-items:center;padding:2rem 2.5rem;">
                    <div style="max-width:520px;">
                        <span
                            style="display:inline-flex;align-items:center;gap:6px;background:rgba(249,115,22,0.2);border:1px solid rgba(249,115,22,0.4);color:#fb923c;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;padding:5px 14px;border-radius:20px;margin-bottom:16px;backdrop-filter:blur(4px);">
                            <span class="material-symbols-outlined" style="font-size:14px;">landscape</span>
                            Anadolu'dan
                        </span>
                        <h2
                            style="font-size:clamp(1.8rem,4vw,2.8rem);font-weight:900;color:white;line-height:1.15;margin-bottom:12px;letter-spacing:-0.5px;">
                            Yöresel<br>Ürünler</h2>
                        <p
                            style="color:rgba(255,255,255,0.8);font-size:clamp(0.85rem,1.5vw,1.05rem);line-height:1.6;margin-bottom:24px;max-width:400px;">
                            Bal, pekmez, tarhana, kurutulmuş meyveler… Anadolu'nun dört bir yanından el emeği, göz nuru
                            yöresel lezzetler.</p>
                        <a href="product_category.html?cat=yoresel"
                            style="display:inline-flex;align-items:center;gap:8px;background:#ec9213;color:white;padding:12px 28px;border-radius:10px;font-weight:700;font-size:0.95rem;text-decoration:none;transition:all 0.3s;box-shadow:0 4px 20px rgba(236,146,19,0.35);">
                            Keşfet <span class="material-symbols-outlined" style="font-size:18px;">arrow_forward</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Show only the relevant category slide based on URL -->
            <script>
                (function () {
                    var urlParams = new URLSearchParams(window.location.search);
                    var rawCat = urlParams.get('cat');
                    var cat = rawCat === 'pestil' ? 'pestil-kome' : rawCat;

                    var valid = ['kuruyemis', 'sarkuteri', 'aktar', 'bakliyat', 'pestil-kome', 'yoresel'];
                    var selected = 'kuruyemis';
                    if (cat && valid.includes(cat)) selected = cat;

                    var slides = document.querySelectorAll('#categoryHero .cat-slide');
                    slides.forEach(function (s) {
                        if (s.getAttribute('data-cat') === selected) s.classList.add('active');
                        else s.classList.remove('active');
                    });

                    // Update breadcrumb/title to match selected category
                    var titles = {
                        kuruyemis: 'Kuruyemiş',
                        sarkuteri: 'Şarküteri',
                        aktar: 'Aktar',
                        bakliyat: 'Bakliyat',
                        'pestil-kome': 'Pestil & Köme',
                        yoresel: 'Yöresel Ürünler'
                    };
                    var bc = document.getElementById('breadcrumbCat');
                    if (bc) bc.textContent = titles[selected] || 'Ürünler';
                })();
            </script>
        </section>

        <!-- Mobile Filter Button & Sort (Visible only on mobile) -->
        <div
            class="lg:hidden flex items-center justify-between gap-4 mb-6 sticky top-[70px] z-30 bg-white p-4 rounded-xl shadow-sm border border-border-light mx-[-16px] px-6">
            <button onclick="toggleMobileFilters()"
                class="flex items-center gap-2 text-sm font-bold text-text-main bg-gray-100 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors">
                <span class="material-symbols-outlined">tune</span> Filtrele
            </button>
            <div class="text-xs text-text-muted font-medium">
                <span id="mobileProductCount">...</span>
            </div>
        </div>

        <div class="flex flex-col lg:flex-row gap-8 relative">

            <!-- Filter Sidebar / Drawer -->
            <!-- Mobile: Fixed Drawer, Desktop: Sidebar -->
            <div id="filterOverlay" onclick="toggleMobileFilters()"
                class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden transition-opacity backdrop-blur-sm"></div>

            <aside id="filterSidebar"
                class="fixed inset-y-0 left-0 w-[280px] bg-white z-50 transform -translate-x-full lg:translate-x-0 lg:static lg:w-64 lg:block shrink-0 transition-transform duration-300 ease-in-out shadow-2xl lg:shadow-none overflow-y-auto lg:overflow-visible h-full lg:h-auto">
                <div class="p-5 lg:p-0 space-y-6 lg:sticky lg:top-28">

                    <!-- Mobile Drawer Header -->
                    <div class="flex items-center justify-between lg:hidden mb-2">
                        <h3 class="font-black text-xl text-text-main">Filtreler</h3>
                        <button onclick="toggleMobileFilters()"
                            class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>

                    <div
                        class="bg-secondary/50 lg:bg-secondary rounded-xl p-5 border border-border-light lg:border-none">
                        <div>
                            <h3 class="font-bold text-sm uppercase tracking-wider text-text-main mb-3">Kategori</h3>
                            <ul id="categoryFilter" class="space-y-2 text-sm text-text-muted"></ul>
                        </div>
                        <div class="border-t border-border-light pt-4 mt-4">
                            <h3 class="font-bold text-sm uppercase tracking-wider text-text-main mb-3">Fiyat Aralığı
                            </h3>
                            <div class="space-y-2">
                                <label class="flex items-center gap-2 cursor-pointer group"><input type="radio"
                                        name="price" value="" checked
                                        class="text-primary focus:ring-primary price-filter accent-primary"> <span
                                        class="text-sm group-hover:text-primary transition-colors">Tümü</span></label>
                                <label class="flex items-center gap-2 cursor-pointer group"><input type="radio"
                                        name="price" value="0-100"
                                        class="text-primary focus:ring-primary price-filter accent-primary"> <span
                                        class="text-sm group-hover:text-primary transition-colors">0 -
                                        100₺</span></label>
                                <label class="flex items-center gap-2 cursor-pointer group"><input type="radio"
                                        name="price" value="100-300"
                                        class="text-primary focus:ring-primary price-filter accent-primary"> <span
                                        class="text-sm group-hover:text-primary transition-colors">100 -
                                        300₺</span></label>
                                <label class="flex items-center gap-2 cursor-pointer group"><input type="radio"
                                        name="price" value="300-500"
                                        class="text-primary focus:ring-primary price-filter accent-primary"> <span
                                        class="text-sm group-hover:text-primary transition-colors">300 -
                                        500₺</span></label>
                                <label class="flex items-center gap-2 cursor-pointer group"><input type="radio"
                                        name="price" value="500+"
                                        class="text-primary focus:ring-primary price-filter accent-primary"> <span
                                        class="text-sm group-hover:text-primary transition-colors">500₺ ve
                                        üzeri</span></label>
                            </div>
                        </div>
                        <div class="border-t border-border-light pt-4 mt-4">
                            <h3 class="font-bold text-sm uppercase tracking-wider text-text-main mb-3">Sıralama</h3>
                            <select id="sortSelect"
                                class="w-full border border-border-light rounded-lg px-3 py-2 text-sm focus:ring-primary focus:border-primary bg-white cursor-pointer hover:border-primary transition-colors">
                                <option value="default">Varsayılan</option>
                                <option value="price-asc">Fiyat: Düşükten Yükseğe</option>
                                <option value="price-desc">Fiyat: Yüksekten Düşüğe</option>
                                <option value="rating">En Yüksek Puan</option>
                                <option value="name">İsme Göre (A-Z)</option>
                            </select>
                        </div>

                        <!-- Mobile Apply Button -->
                        <button onclick="toggleMobileFilters()"
                            class="w-full mt-6 bg-primary text-white font-bold py-3 rounded-xl lg:hidden shadow-lg shadow-primary/20">
                            Sonuçları Göster
                        </button>
                    </div>
                </div>
            </aside>

            <div class="flex-1">
                <div class="flex items-center justify-between mb-6">
                    <h1 id="pageTitle" class="text-2xl lg:text-3xl font-black text-text-main">Ürünler</h1>
                    <span id="productCount" class="text-text-muted text-sm font-medium"></span>
                </div>
                <div id="productsGrid" class="grid grid-cols-2 sm:grid-cols-2 xl:grid-cols-3 gap-4"></div>
                <div id="emptyState" class="hidden text-center py-20">
                    <span class="material-symbols-outlined text-6xl text-gray-300 mb-4">inventory_2</span>
                    <p class="text-text-muted text-lg font-medium">Bu kriterlere uygun ürün bulunamadı.</p>
                    <a href="product_category.html" class="mt-4 inline-block text-primary font-bold hover:underline">Tüm
                        ürünleri göster</a>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer injected by main.js -->

    <script type="module" src="/src/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Need to wait for main.js to initialize HaktanApp? 
            // Since module scripts defer, and this is regular script... wait, DOMContentLoaded fires after defer scripts?
            // Actually, type="module" scripts are deferred. 
            // Standard scripts run immediately.
            // HaktanApp might not be ready if main.js is module.
            // We should make this a module script too or import from internal logic.
            // But relying on window.HaktanApp from a module requires waiting.
            // Better: use type="module" here too and import HaktanApp or wait.

            // However, inline module scripts work.
        });
    </script>
    <script type="module">
        import { getProducts, getProductsByCategory, searchProducts } from './src/modules/products.js';
        import { getUrlParam, getCategoryName, CATEGORY_NAMES } from './src/modules/utils.js';
        import { renderProductCard } from './src/modules/ui.js';

        var rawCat = getUrlParam('cat');
        var cat = rawCat === 'pestil' ? 'pestil-kome' : rawCat;
        var query = getUrlParam('q');
        var categoryName = cat ? getCategoryName(cat) : (query ? '"' + query + '" araması' : 'Tüm Ürünler');

        document.getElementById('pageTitle').textContent = categoryName;
        document.getElementById('breadcrumbCat').textContent = categoryName;
        document.title = 'HAKTAN - ' + categoryName;

        // Build category filter
        var catFilter = document.getElementById('categoryFilter');
        var allCats = [{ slug: '', name: 'Tümü' }];
        Object.keys(CATEGORY_NAMES).forEach(function (k) {
            allCats.push({ slug: k, name: CATEGORY_NAMES[k] });
        });
        allCats.forEach(function (c) {
            var li = document.createElement('li');
            var a = document.createElement('a');
            a.href = c.slug ? 'product_category.html?cat=' + c.slug : 'product_category.html';
            a.textContent = c.name;
            a.className = 'block py-1.5 px-2 rounded hover:bg-white hover:text-primary transition-colors ' +
                (cat === c.slug || (!cat && !c.slug && !query) ? 'text-primary font-bold bg-white' : '');
            li.appendChild(a);
            catFilter.appendChild(li);
        });

        async function getFilteredProducts() {
            var products;
            try {
                if (query) {
                    products = await searchProducts(query);
                } else if (cat) {
                    products = await getProductsByCategory(cat);
                } else {
                    products = await getProducts();
                }

                var priceVal = document.querySelector('.price-filter:checked');
                if (priceVal && priceVal.value) {
                    var range = priceVal.value;
                    if (range === '500+') {
                        products = products.filter(function (p) { return p.price >= 500; });
                    } else {
                        var parts = range.split('-');
                        var min = parseInt(parts[0]), max = parseInt(parts[1]);
                        products = products.filter(function (p) { return p.price >= min && p.price <= max; });
                    }
                }

                var sort = document.getElementById('sortSelect').value;
                if (sort === 'price-asc') products.sort(function (a, b) { return a.price - b.price; });
                else if (sort === 'price-desc') products.sort(function (a, b) { return b.price - a.price; });
                else if (sort === 'rating') products.sort(function (a, b) { return b.rating - a.rating; });
                else if (sort === 'name') products.sort(function (a, b) { return a.name.localeCompare(b.name, 'tr'); });

                return products;
            } catch (e) {
                console.error("Filter error:", e);
                return [];
            }
        }

        // Mobile Filter Logic
        window.toggleMobileFilters = function () {
            const sidebar = document.getElementById('filterSidebar');
            const overlay = document.getElementById('filterOverlay');
            const body = document.body;

            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
                body.style.overflow = 'hidden';
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
                body.style.overflow = '';
            }
        }

        async function renderProducts() {
            var grid = document.getElementById('productsGrid');
            var empty = document.getElementById('emptyState');
            var count = document.getElementById('productCount');
            var mobileCount = document.getElementById('mobileProductCount');

            // Show loading
            grid.innerHTML = '<p class="col-span-full text-center py-20 text-gray-400 italic">Yükleniyor...</p>';

            var products = await getFilteredProducts();

            var countText = products.length + ' ürün';
            count.textContent = countText;
            if (mobileCount) mobileCount.textContent = countText;

            if (products.length === 0) {
                grid.classList.add('hidden');
                empty.classList.remove('hidden');
                return;
            }
            grid.classList.remove('hidden');
            empty.classList.add('hidden');

            grid.innerHTML = products.map(function (p) { return renderProductCard(p); }).join('');
        }

        renderProducts();

        document.querySelectorAll('.price-filter').forEach(function (el) {
            el.addEventListener('change', renderProducts);
        });
        document.getElementById('sortSelect').addEventListener('change', renderProducts);
    </script>
</body>

</html>